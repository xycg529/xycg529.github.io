<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MySQL基础语句学习记录</title>
    <url>/Quick-Study-MySQL/</url>
    <content><![CDATA[<p>来源：<a href="https://www.bilibili.com/video/BV1m84y1w7Tb">黑马程序员JavaWeb</a>中MySQL部分的讲解</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># <span class="keyword">create</span> <span class="keyword">table</span> tb_user</span><br><span class="line"># (</span><br><span class="line">#     id       <span class="type">int</span> comment <span class="string">&#x27;ID, 唯一标识&#x27;</span>,</span><br><span class="line">#     username <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">#     name     <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">#     age      <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">#     gender   <span class="type">char</span>(<span class="number">1</span>) comment <span class="string">&#x27;性别&#x27;</span></span><br><span class="line"># ) comment <span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># 建表语句</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user</span><br><span class="line">(</span><br><span class="line">    id       <span class="type">int</span> <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID, 唯一标识&#x27;</span>,</span><br><span class="line">    username <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    name     <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age      <span class="type">int</span> comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    gender   <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;男&#x27;</span> comment <span class="string">&#x27;性别&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查看所有存在表格</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"></span><br><span class="line"># 查看字段</span><br><span class="line"><span class="keyword">desc</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 添加字段</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">    <span class="keyword">add</span> qq <span class="type">varchar</span>(<span class="number">11</span>) comment <span class="string">&#x27;QQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 修改表中字段数据类型</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">    modify qq <span class="type">varchar</span>(<span class="number">13</span>) comment <span class="string">&#x27;QQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 修改表中的字段</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">    change qq qq_num <span class="type">varchar</span>(<span class="number">13</span>) comment <span class="string">&#x27;QQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 删除表中的字段</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">    <span class="keyword">drop</span> <span class="keyword">column</span> qq_num;</span><br><span class="line"></span><br><span class="line"># 改名</span><br><span class="line">rename <span class="keyword">table</span> tb_emp <span class="keyword">to</span> emp;</span><br><span class="line"></span><br><span class="line">rename <span class="keyword">table</span> emp <span class="keyword">to</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 若存在时，删除表格</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> tb_emp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 向表格中插入指定字段的数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_emp(username, name, gender, create_time, update_time)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;wuji&#x27;</span>, <span class="string">&#x27;zhangwuji&#x27;</span>, <span class="number">1</span>, now(), now());</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> tb_emp</span><br><span class="line"><span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">    update_time<span class="operator">=</span>now()</span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 更新所有</span><br><span class="line"><span class="keyword">update</span> tb_emp</span><br><span class="line"><span class="keyword">set</span> entrydate<span class="operator">=</span><span class="string">&#x27;2010-01-01&#x27;</span>,</span><br><span class="line">    update_time<span class="operator">=</span>now();</span><br><span class="line"></span><br><span class="line"># 从表中删除id<span class="operator">=</span><span class="number">1</span>的项</span><br><span class="line"><span class="keyword">delete</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 从tb_emp表中查询name和entrydate字段</span><br><span class="line"><span class="keyword">select</span> name, entrydate</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 此方法查全部字段性能低不推荐</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 推荐使用查全部字段的方式</span><br><span class="line"><span class="keyword">select</span> id,</span><br><span class="line">       username,</span><br><span class="line">       password,</span><br><span class="line">       name,</span><br><span class="line">       gender,</span><br><span class="line">       image,</span><br><span class="line">       job,</span><br><span class="line">       entrydate,</span><br><span class="line">       create_time,</span><br><span class="line">       update_time</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 查询并起别名，<span class="keyword">as</span>可省略</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">as</span> 姓名, entrydate <span class="keyword">as</span> 入职日期</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 查询并去除重复</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> job</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 查询表中指定数据的项</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> id <span class="operator">&lt;=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> job <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> job <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"># <span class="operator">!=</span>可以用<span class="operator">&lt;&gt;</span>代替</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> password <span class="operator">!=</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrytime <span class="operator">&gt;=</span> <span class="string">&#x27;2000-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> entrydate <span class="operator">&lt;=</span> <span class="string">&#x27;2010-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 可以写成between...and...</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrytime <span class="keyword">between</span> <span class="string">&#x27;2000-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2010-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrytime <span class="keyword">between</span> <span class="string">&#x27;2000-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2010-01-01&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> gender <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> job <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">   <span class="keyword">or</span> job <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">   <span class="keyword">or</span> job <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"># 可以写成<span class="keyword">in</span>(...)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> job <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"># 查询名字是两个字的项</span><br><span class="line"># _ 匹配单个字符，这里匹配两个</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;__&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查询姓氏张的项</span><br><span class="line"># <span class="operator">%</span> 匹配任意个字符</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 统计员工数量</span><br><span class="line"># 聚合函数不统计值为<span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"># a. <span class="built_in">count</span>(字段)</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(id)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># b.<span class="built_in">count</span>(常量)</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># c.<span class="built_in">count</span>(<span class="operator">*</span>)，推荐，底层有优化</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 统计最早入职的</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(entrydate)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 统计最迟入职的</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(entrydate)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 统计ID平均值</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(id)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 统计ID之和</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(id)</span><br><span class="line"><span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 根据性别分组，统计男女数量</span><br><span class="line"># <span class="keyword">select</span>的字段必须与<span class="keyword">group</span> <span class="keyword">by</span>一致，或有其他聚合函数，其他字段无意义且报错</span><br><span class="line"><span class="keyword">select</span> gender, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询入职在<span class="number">2015</span><span class="number">-01</span><span class="number">-01</span>以前的员工，并根据职位分组，统计员工数量<span class="operator">&gt;=</span><span class="number">2</span>的职位</span><br><span class="line"># <span class="keyword">where</span>不能判断聚合函数</span><br><span class="line"># <span class="keyword">having</span>用于分组后的过滤条件，可以判断聚合函数</span><br><span class="line"><span class="keyword">select</span> job, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrydate <span class="operator">&lt;=</span> <span class="string">&#x27;2015-01-01&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> job</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"># 根据入职时间升序排序，<span class="keyword">asc</span>是默认，可省略</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> entrydate <span class="keyword">asc</span>;</span><br><span class="line"></span><br><span class="line"># 降序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> entrydate <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"># 先根据入职时间升序，若入职时间相同再按照更新时间降序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> entrydate, update_time <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"># 从起始索引<span class="number">0</span>开始查，每页<span class="number">5</span>条</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line">limit <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># 查询第二页，每页<span class="number">5</span>条</span><br><span class="line"># 从第<span class="number">6</span>个开始，索引是<span class="number">5</span></span><br><span class="line"># 起始索引<span class="operator">=</span>(页码<span class="number">-1</span>)×页数</span><br><span class="line"># limit是方言，查第一页可省略起始索引</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line">limit <span class="number">5</span>,<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"># 查第一页，每页<span class="number">10</span>条，输入姓名（模糊）性别（精确）时间（范围）可搜索到信息，对修改时间倒序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%张%&#x27;</span></span><br><span class="line">  <span class="keyword">and</span> gender <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">and</span> entrydate</span><br><span class="line">    <span class="keyword">between</span> <span class="string">&#x27;2000-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2015-12-31&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> update_time <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 用if把<span class="number">1</span>变男，<span class="number">2</span>变女</span><br><span class="line"><span class="keyword">select</span> if(gender <span class="operator">=</span> <span class="number">1</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;女&#x27;</span>) 性别, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br><span class="line"></span><br><span class="line"># <span class="keyword">case</span>解决多分支</span><br><span class="line"><span class="keyword">select</span> (<span class="keyword">case</span> job</span><br><span class="line">            <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;班主任&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;讲师&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;学工主管&#x27;</span></span><br><span class="line">            <span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;教研主管&#x27;</span></span><br><span class="line">            <span class="keyword">else</span> <span class="string">&#x27;未分配职位&#x27;</span></span><br><span class="line">    <span class="keyword">end</span>) 职位,</span><br><span class="line">       <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> job;</span><br><span class="line"></span><br><span class="line"># 多表设计</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span> auto_increment</span><br><span class="line">        <span class="keyword">primary</span> key,</span><br><span class="line">    username    <span class="type">varchar</span>(<span class="number">20</span>)                       <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    password    <span class="type">varchar</span>(<span class="number">32</span>)      <span class="keyword">default</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">null</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">    name        <span class="type">varchar</span>(<span class="number">10</span>)                       <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    gender      tinyint unsigned <span class="keyword">default</span> <span class="string">&#x27;1&#x27;</span>      <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别：1男 2女&#x27;</span>,</span><br><span class="line">    image       <span class="type">varchar</span>(<span class="number">300</span>)                      <span class="keyword">null</span> comment <span class="string">&#x27;图像url&#x27;</span>,</span><br><span class="line">    job         tinyint unsigned                  <span class="keyword">null</span> comment <span class="string">&#x27;职位：1班主任 2讲师 3学生主管 4教研主管&#x27;</span>,</span><br><span class="line">    entrydate   <span class="type">date</span>                              <span class="keyword">null</span> comment <span class="string">&#x27;入职日期&#x27;</span>,</span><br><span class="line">    dept_id     <span class="type">int</span> unsigned                      <span class="keyword">null</span> comment <span class="string">&#x27;归属部门ID&#x27;</span>,</span><br><span class="line">    create_time datetime                          <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time datetime                          <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_dept</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    name        <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    create_time datetime    <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time datetime    <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 使用物理外键建立关联，将tb_emp的dept_id<span class="operator">-</span><span class="operator">&gt;</span>tb_dept的id</span><br><span class="line"># 增删改时要检查外键关系</span><br><span class="line"># 仅用于单节点场景，不适用于分布式、集群</span><br><span class="line"># 容易引发死锁消耗性能</span><br><span class="line"># 在业务层逻辑中使用逻辑外键可解决上述问题</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">    <span class="keyword">add</span> <span class="keyword">constraint</span> tb_emp___fk_dept_id</span><br><span class="line">        <span class="keyword">foreign</span> key (dept_id) <span class="keyword">references</span> tb_dept (id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 一对一</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user</span><br><span class="line">(</span><br><span class="line">    id     <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    name   <span class="type">varchar</span>(<span class="number">10</span>)      <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    gender tinyint unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别：1男2女&#x27;</span>,</span><br><span class="line">    phone  <span class="type">char</span>(<span class="number">11</span>) comment <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">    degree <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;学历&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user</span><br><span class="line"><span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;白眉&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;18812340001&#x27;</span>, <span class="string">&#x27;初中&#x27;</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;青翼&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;18812340002&#x27;</span>, <span class="string">&#x27;大专&#x27;</span>),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;金毛&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;18812340003&#x27;</span>, <span class="string">&#x27;初中&#x27;</span>),</span><br><span class="line">       (<span class="number">4</span>, <span class="string">&#x27;紫衫&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;18812340004&#x27;</span>, <span class="string">&#x27;硕士&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_user_card</span><br><span class="line">(</span><br><span class="line">    id           <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    nationality  <span class="type">varchar</span>(<span class="number">10</span>)  <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;民族&#x27;</span>,</span><br><span class="line">    birthday     <span class="type">date</span>         <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;生日&#x27;</span>,</span><br><span class="line">    idcard       <span class="type">char</span>(<span class="number">18</span>)     <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;身份证号&#x27;</span>,</span><br><span class="line">    issued       <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;签发机关&#x27;</span>,</span><br><span class="line">    expire_begin <span class="type">date</span>         <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;有效期-开始&#x27;</span>,</span><br><span class="line">    expire_end   <span class="type">date</span> comment <span class="string">&#x27;有效期-结束&#x27;</span>,</span><br><span class="line">    user_id      <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">    <span class="keyword">constraint</span> fk_user_id <span class="keyword">foreign</span> key (user_id) <span class="keyword">references</span> tb_user (id)</span><br><span class="line">) comment <span class="string">&#x27;用户信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_user_card</span><br><span class="line"><span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;汉&#x27;</span>, <span class="string">&#x27;1960-11-06&#x27;</span>, <span class="string">&#x27;100000100000100001&#x27;</span>, <span class="string">&#x27;朝阳区&#x27;</span>, <span class="string">&#x27;2000-06-10&#x27;</span>, <span class="keyword">null</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;汉&#x27;</span>, <span class="string">&#x27;1971-11-06&#x27;</span>, <span class="string">&#x27;100000100000100002&#x27;</span>, <span class="string">&#x27;静安区&#x27;</span>, <span class="string">&#x27;2005-06-10&#x27;</span>, <span class="string">&#x27;2025-06-10&#x27;</span>, <span class="number">2</span>),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;汉&#x27;</span>, <span class="string">&#x27;1963-11-06&#x27;</span>, <span class="string">&#x27;100000100000100003&#x27;</span>, <span class="string">&#x27;昌平区&#x27;</span>, <span class="string">&#x27;2006-06-10&#x27;</span>, <span class="keyword">null</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">4</span>, <span class="string">&#x27;回&#x27;</span>, <span class="string">&#x27;1980-11-06&#x27;</span>, <span class="string">&#x27;100000100000100004&#x27;</span>, <span class="string">&#x27;海淀区&#x27;</span>, <span class="string">&#x27;2008-06-10&#x27;</span>, <span class="string">&#x27;2028-06-10&#x27;</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使用第三张中间表实现多对多的关系</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_student</span><br><span class="line">(</span><br><span class="line">    id   <span class="type">int</span> auto_increment <span class="keyword">primary</span> key comment <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    <span class="keyword">no</span>   <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;学号&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;学生表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_student(name, <span class="keyword">no</span>)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;黛绮丝&#x27;</span>, <span class="string">&#x27;2000100101&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;谢逊&#x27;</span>, <span class="string">&#x27;2000100102&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;殷天正&#x27;</span>, <span class="string">&#x27;2000100103&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;韦一笑&#x27;</span>, <span class="string">&#x27;2000100104&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_course</span><br><span class="line">(</span><br><span class="line">    id   <span class="type">int</span> auto_increment <span class="keyword">primary</span> key comment <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) comment <span class="string">&#x27;课程名称&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;课程表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_course (name)</span><br><span class="line"><span class="keyword">values</span> (<span class="string">&#x27;Java&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;PHP&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;MySQL&#x27;</span>),</span><br><span class="line">       (<span class="string">&#x27;Hadoop&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 中间表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_student_course</span><br><span class="line">(</span><br><span class="line">    id         <span class="type">int</span> auto_increment <span class="keyword">primary</span> key comment <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">    student_id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学生ID&#x27;</span>,</span><br><span class="line">    course_id  <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;课程ID&#x27;</span>,</span><br><span class="line">    <span class="keyword">constraint</span> fk_courseid <span class="keyword">foreign</span> key (course_id) <span class="keyword">references</span> tb_course (id),</span><br><span class="line">    <span class="keyword">constraint</span> fk_studentid <span class="keyword">foreign</span> key (student_id) <span class="keyword">references</span> tb_student (id)</span><br><span class="line">) comment <span class="string">&#x27;学生课程中间表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_student_course(student_id, course_id)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">       (<span class="number">1</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="number">3</span>),</span><br><span class="line">       (<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"># 多表查询</span><br><span class="line"># 笛卡尔积产生无效冗余数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp,</span><br><span class="line">     tb_dept;</span><br><span class="line"></span><br><span class="line"># 消除笛卡尔积，获得正确数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp,</span><br><span class="line">     tb_dept</span><br><span class="line"><span class="keyword">where</span> tb_dept.id <span class="operator">=</span> tb_emp.id;</span><br><span class="line"></span><br><span class="line"># 查询姓名及部门名</span><br><span class="line"># 隐式内连接</span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_dept,</span><br><span class="line">     tb_emp</span><br><span class="line"><span class="keyword">where</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"># 显式内连接</span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line">         <span class="keyword">inner</span> <span class="keyword">join</span> tb_dept <span class="keyword">on</span> tb_dept.id <span class="operator">=</span> tb_emp.dept_id;</span><br><span class="line"></span><br><span class="line"># 起别名</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp e,</span><br><span class="line">     tb_dept d</span><br><span class="line"><span class="keyword">where</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"># 查询所有姓名及部门名</span><br><span class="line"># 左外连接，完全包含左表数据</span><br><span class="line"><span class="keyword">select</span> e.name, d.name</span><br><span class="line"><span class="keyword">from</span> tb_emp e</span><br><span class="line">         <span class="keyword">left</span> <span class="keyword">join</span> tb_dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"># 查询所有部门名及姓名</span><br><span class="line"># 右外连接，完全包含右表数据</span><br><span class="line"><span class="keyword">select</span> e.name, d.name</span><br><span class="line"><span class="keyword">from</span> tb_emp e</span><br><span class="line">         <span class="keyword">right</span> <span class="keyword">join</span> tb_dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"># 可以转换成左外连接，对调表名位置即可</span><br><span class="line"><span class="keyword">select</span> e.name, d.name</span><br><span class="line"><span class="keyword">from</span> tb_dept d</span><br><span class="line">         <span class="keyword">left</span> <span class="keyword">join</span> tb_emp e <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"># 嵌套查询</span><br><span class="line"># 标量子查询，查询教研部所有员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> dept_id <span class="operator">=</span> (<span class="keyword">select</span> id <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 查询张三入职后的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrydate <span class="operator">&gt;</span> (<span class="keyword">select</span> entrydate <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 列子查询</span><br><span class="line"># 查询教研部及咨询部的所有员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="keyword">in</span> (<span class="string">&#x27;教研部&#x27;</span>, <span class="string">&#x27;咨询部&#x27;</span>));</span><br><span class="line"></span><br><span class="line"># 行子查询</span><br><span class="line"># 查询与李四的入职日期和职位都相同的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> (entrydate, job) <span class="operator">=</span> (<span class="keyword">select</span> entrydate, job <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;李四&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 表子查询</span><br><span class="line"># 查询入职日期是<span class="number">2008</span><span class="number">-02</span><span class="number">-02</span>之后的员工及部门名称</span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.name</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;</span> <span class="string">&#x27;2008-02-02&#x27;</span>) e,</span><br><span class="line">     tb_dept d</span><br><span class="line"><span class="keyword">where</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"># 查询价格<span class="operator">&lt;</span><span class="number">10</span>的菜品名称，价格及分类名称</span><br><span class="line"><span class="keyword">select</span> d.name, d.price, c.name</span><br><span class="line"><span class="keyword">from</span> dish d,</span><br><span class="line">     category c</span><br><span class="line"><span class="keyword">where</span> d.category_id <span class="operator">=</span> c.id</span><br><span class="line">  <span class="keyword">and</span> d.price <span class="operator">&lt;</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"># 查询价格<span class="number">10</span><span class="operator">~</span><span class="number">50</span>且在售的菜品，展示其名称，价格，分类（包括<span class="keyword">null</span>）</span><br><span class="line"><span class="keyword">select</span> d.name, d.price, c.name</span><br><span class="line"><span class="keyword">from</span> dish d</span><br><span class="line">         <span class="keyword">left</span> <span class="keyword">join</span> category c <span class="keyword">on</span> d.category_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">where</span> d.price <span class="keyword">between</span> <span class="number">10</span> <span class="keyword">and</span> <span class="number">50</span></span><br><span class="line">  <span class="keyword">and</span> d.status <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 查询各分类下最贵菜品，展示分类，价格</span><br><span class="line"><span class="keyword">select</span> c.name, <span class="built_in">max</span>(d.price)</span><br><span class="line"><span class="keyword">from</span> dish d,</span><br><span class="line">     category c</span><br><span class="line"><span class="keyword">where</span> d.category_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.name;</span><br><span class="line"></span><br><span class="line"># 查询各分类下在售并且份数<span class="operator">&gt;</span><span class="number">3</span>的菜品分类名称</span><br><span class="line"><span class="keyword">select</span> c.name, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> dish d,</span><br><span class="line">     category c</span><br><span class="line"><span class="keyword">where</span> d.category_id <span class="operator">=</span> c.id</span><br><span class="line">  <span class="keyword">and</span> d.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.name</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"># 查询商务套餐A有哪些菜品，展示套餐名称，价格、菜品名称，价格，份数</span><br><span class="line"><span class="keyword">select</span> s.name, s.price, d.name, d.price, sd.copies</span><br><span class="line"><span class="keyword">from</span> setmeal_dish sd,</span><br><span class="line">     dish d,</span><br><span class="line">     setmeal s</span><br><span class="line"><span class="keyword">where</span> sd.setmeal_id <span class="operator">=</span> s.id</span><br><span class="line">  <span class="keyword">and</span> sd.dish_id <span class="operator">=</span> d.id</span><br><span class="line">  <span class="keyword">and</span> s.name <span class="operator">=</span> <span class="string">&#x27;商务套餐A&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查询低于平均价格的菜品名称，价格</span><br><span class="line"><span class="keyword">select</span> name, price <span class="keyword">from</span> dish <span class="keyword">where</span> price <span class="operator">&lt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(price) <span class="keyword">from</span> dish);</span><br><span class="line"></span><br><span class="line"># 开启事务</span><br><span class="line"># 事务内的操作要么同时成功要么同时失败</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line"></span><br><span class="line"># 删除部门</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tb_dept <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 删除员工</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> dept_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 提交事务</span><br><span class="line"># 提交事务之前，虽然<span class="keyword">select</span>查看已经发生删除，但实际上数据仍然存在</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"># 提交之后才会真正改变</span><br><span class="line"></span><br><span class="line"># 回滚事务</span><br><span class="line"># 回退到开始事务前的状态</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line"># 创建索引，在大量数据的情况下加快查找该字段下数据的速度</span><br><span class="line"># 没有索引时，如果字段项不唯一要全表扫描</span><br><span class="line"># 有索引时（有助于搜索的数据结构，默认B<span class="operator">+</span>树）遍历索引结构即可</span><br><span class="line"># 索引会占用存储空间，降低增删改的效率</span><br><span class="line"><span class="keyword">create</span> index idx_tb_emp_id <span class="keyword">on</span> tb_emp(id);</span><br><span class="line"></span><br><span class="line"># 查看索引</span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 删除索引</span><br><span class="line"><span class="keyword">drop</span> index idx_tb_emp_id <span class="keyword">on</span> tb_emp;</span><br><span class="line"></span><br><span class="line"># 主键字段在建表时自动创建索引，主键索引效率最高</span><br><span class="line"># 字段添加<span class="keyword">unique</span>时会添加唯一索引</span><br></pre></td></tr></table></figure>



]]></content>
      <tags>
        <tag>MySQL</tag>
        <tag>开发</tag>
      </tags>
  </entry>
</search>
